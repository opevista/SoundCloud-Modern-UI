/* === フォント読み込み === */
@font-face {
  font-family: "Inter";
  src: url("../assets/fonts/InterVariable.woff2") format("woff2");
  font-weight: 100 900;
  font-stretch: 75% 125%;
  font-display: swap;
}

/* 全体のボックスサイズ計算を統一して、はみ出し事故を防ぐ */
* {
  font-family: 'SF Pro Display', 'Inter', 'Noto Sans JP';
  box-sizing: border-box;
}

/* === 背景ぼかし === */
#scm-custom-bg {
  position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
  background-size: cover; background-position: center center;
  z-index: 1000; background-color: rgba(5,5,5,0.5);
  /* Keep blur/saturation but remove brightness dimming and force full opacity */
  filter: blur(120px) saturate(100%) brightness(1) !important;
  opacity: 1 !important;
  transform: scale(1.75); pointer-events: none; display: none;
}
body.scm-custom-layout #scm-custom-bg { display: block !important; }

/* 背景動くやつ*/
@keyframes scmBgDrift {
  0% {
    transform: scale(1.715) translate3d(-3%, -3%, 0);
  }
  50% {
    transform: scale(1.715) translate3d(4%, 2%, 0);
  }
  100% {
    transform: scale(1.715) translate3d(-2%, 4%, 0);
  }
}

body.scm-custom-layout #scm-custom-bg {
  display: block !important;
  animation: scmBgDrift 40s ease-in-out infinite alternate;
}

/* === メインレイアウト === */
#scm-custom-wrapper {
  position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
  display: none; flex-direction: row; justify-content: center; align-items: center;
  gap: 8vw; padding: 60px 5vw 140px 5vw; box-sizing: border-box; z-index: 1001;
  transition: all 0.5s ease;
  pointer-events: none;
}
body.scm-custom-layout #scm-custom-wrapper { display: flex !important; }

/* ラッパー内のインタラクティブ要素は操作可能にする */
#scm-custom-wrapper button,
#scm-custom-wrapper .scm-glass-btn,
#scm-custom-wrapper #scm-btn-area {
  pointer-events: auto !important;
}

/* IMMERSIONモード時に背景の要素を触れなくする */
body.scm-custom-layout #main-content,
body.scm-custom-layout .l-main,
body.scm-custom-layout .l-sidebar,
body.scm-custom-layout .l-content,
body.scm-custom-layout .sc-list,
body.scm-custom-layout .sc-list-item,
body.scm-custom-layout .sc-media,
body.scm-custom-layout .sc-artwork,
body.scm-custom-layout .sc-button,
body.scm-custom-layout a:not(.playControls a):not(.playControls__inner a):not(#scm-mode-toggle) {
  pointer-events: none !important;
}

/* Hide the entire app container in Immersion mode (user request) */
/* Avoid hiding #app entirely; hide main content via specific selectors instead so playControls remains visible */
/* body.scm-custom-layout #app {
  display: none !important;
  visibility: hidden !important;
  pointer-events: none !important;
} */

/* Ensure the play controls are always visible in Immersion mode */
body.scm-custom-layout .playControls,
body.scm-custom-layout .playControls__inner,
body.scm-custom-layout .playControls.g-z-index-control-bar.m-visible {
  display: block !important;
  visibility: visible !important;
  opacity: 1 !important;
  pointer-events: auto !important;
}

/* ナビゲーションバーは操作可能 */
body.scm-custom-layout .g-header,
body.scm-custom-layout .header,
body.scm-custom-layout nav,
body.scm-custom-layout nav a,
body.scm-custom-layout nav button {
  pointer-events: auto !important;
}

/* Hide top-level (immediate) children of #app while preserving header/nav/player
   This hides the main content but ensures the player controls + header remain interactive */
body.scm-custom-layout #app > * {
  display: none !important;
  visibility: hidden !important;
  pointer-events: none !important;
  opacity: 0 !important;
}

/* Exceptions: keep the header, nav and play controls visible and interactive */
body.scm-custom-layout #app > .g-header,
body.scm-custom-layout #app > .header,
body.scm-custom-layout #app > nav,
body.scm-custom-layout #app > .playControls,
body.scm-custom-layout #app > .playControls__inner,
body.scm-custom-layout #app > .playControls.g-z-index-control-bar.m-visible,
body.scm-custom-layout #app > .playControls__wrapper,
body.scm-custom-layout #app > .playControls__wrapper.l-container.l-fullwidth {
  display: block !important;
  visibility: visible !important;
  pointer-events: auto !important;
  opacity: 1 !important;
}

/* SoundCloud要素を非表示（プレーヤーコントロールは除く） */
body.scm-custom-layout .playbackSoundBadge:not(.playControls__soundBadge),
body.scm-custom-layout .soundTitle,
body.scm-custom-layout .sc-artwork,
body.scm-custom-layout .sc-media,
body.scm-custom-layout .sc-player,
body.scm-custom-layout .sc-ministats,
body.scm-custom-layout .sc-header,
body.scm-custom-layout .l-header,
body.scm-custom-layout .l-main,
body.scm-custom-layout .l-sidebar {
    visibility: hidden !important; opacity: 0 !important; pointer-events: none !important;
}

/* プレーヤーコントロール内のplaybackSoundBadgeは表示 */
body.scm-custom-layout .playControls__soundBadge,
body.scm-custom-layout .playControls .playbackSoundBadge {
    visibility: visible !important;
    opacity: 1 !important;
    pointer-events: auto !important;
}

/* Immersionモード時はプレイバー内のアバターとタイトルのコンテキスト（余分な要素）を非表示にする */
body.scm-custom-layout .playControls__soundBadge .playbackSoundBadge__avatar,
body.scm-custom-layout .playControls__soundBadge .playbackSoundBadge__avatar.sc-media-image.sc-mr-2x,
body.scm-custom-layout .playControls__soundBadge .playbackSoundBadge__titleContextContainer,
body.scm-custom-layout .playControls__soundBadge .playbackSoundBadge__titleContextContainer.sc-mr-3x {
  display: none !important; /* 完全に非表示にする */
  visibility: hidden !important;
  opacity: 0 !important;
  pointer-events: none !important;
}

/* ナビゲーションバーは表示 */
body.scm-custom-layout .g-header,
body.scm-custom-layout .header,
body.scm-custom-layout nav {
    visibility: visible !important; opacity: 1 !important; pointer-events: auto !important;
    position: fixed; top: 0; left: 0; width: 100%;
    background: rgba(0,0,0,0.2) !important; backdrop-filter: blur(10px);
    border-bottom: 1px solid rgba(255,255,255,0.05); z-index: 2000;
}

#scm-custom-left-col {
  display: flex;
  flex-direction: column;
  align-items: center;
  width: 400px;
  text-align: center;
  transition: transform 0.5s ease;
}

#scm-artwork-container {
  width: 100%;
  aspect-ratio: 1;
  border-radius: 16px;
  box-shadow: 0 20px 60px rgba(0,0,0,0.6);
  overflow: hidden;
  margin-bottom: 30px;
}

#scm-artwork-container img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

#scm-custom-title {
  font-size: 32px;
  font-weight: 900;
  color: #fff;
  margin-bottom: 8px;
  line-height: 1.2;
  text-shadow: 0 4px 10px rgba(0,0,0,0.5);
  word-break: keep-all;
  overflow-wrap: break-word;
}

#scm-custom-artist {
  font-size: 20px;
  font-weight: 600;
  color: rgba(255,255,255,0.7);
  margin-bottom: 24px;
}

#scm-btn-area {
  display: flex;
  gap: 10px;
  margin-top: 10px;
  transition: opacity 0.5s ease, visibility 0.5s ease;
  opacity: 1;
  visibility: visible;
}

#scm-btn-area.inactive {
  opacity: 0;
  visibility: hidden;
  pointer-events: none;
}

.scm-glass-btn {
  padding: 8px 16px;
  background: rgba(255,255,255,0.1);
  border: 1px solid rgba(255,255,255,0.15);
  border-radius: 20px;
  color: #fff;
  cursor: pointer;
  font-weight: 700;
  backdrop-filter: blur(10px);
  font-size: 13px;
  transition: 0.2s;
}

.scm-glass-btn:hover {
  background: rgba(255,255,255,0.25);
  transform: scale(1.02);
}

.scm-glass-btn.icon-btn {
  padding: 8px 12px;
  font-size: 16px;
}


/* オーディオスペクトラムエリア */
#scm-spectrum-container {
  width: 600px;
  height: 65vh;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 16px;
  background: rgba(0, 0, 0, 0.2);
  backdrop-filter: blur(10px);
  border: 1px solid rgba(255, 255, 255, 0.1);
  padding: 20px;
  box-sizing: border-box;
}

#scm-spectrum-container canvas {
  width: 100%;
  height: 100%;
  border-radius: 12px;
}

/* === プレーヤーバー === */
/* playControls g-z-index-control-bar m-visibleを表示（没入モード時にプレイヤーコントロールが見えるように） */
body.scm-custom-layout .playControls.g-z-index-control-bar.m-visible {
  display: block !important;
  visibility: visible !important;
  opacity: 1 !important;
  pointer-events: auto !important;
  position: fixed !important;
  bottom: 40px !important;
  left: 50% !important;
  transform: translateX(-50%) !important;
  /* prefer content width up to 95% of the viewport; ensure min width so controls don't overflow */
  /* try width:auto and ensure minimum width rather than only max-content which can collapse unexpectedly */
  width: auto !important;
  max-width: 95% !important;
  /* removed forced min width so it can shrink/grow according to content */
  /* allow shrinking but set a reasonable minimum so it doesn't collapse */
  min-width: min-content !important;
  z-index: 2001 !important;
}

/* playControls__innerはそのまま表示（Immersionモード時も通常時も） */
body.scm-custom-layout .playControls__inner {
  position: fixed !important;
  bottom: 40px !important;
  left: 50% !important;
  transform: translateX(-50%) !important;
  /* try to expand to the size needed to fit child controls while respecting screen width */
  /* ensure not to collapse to small width */
  width: auto !important;
  max-width: 95% !important;
  /* removed forced min width so it can shrink/grow according to content */
  /* allow shrinking but set a reasonable minimum so it doesn't collapse */
  min-width: min-content !important;
  min-height: 80px !important;
  border-radius: 40px !important;
  background: rgba(20,20,20,0.6) !important;
  backdrop-filter: blur(60px) saturate(180%) !important;
  border: 1px solid rgba(255,255,255,0.15) !important;
  display: flex !important;
  flex-wrap: nowrap !important;
  white-space: nowrap !important;
  justify-content: space-between !important;
  align-items: center !important;
  box-shadow: 0 20px 50px rgba(0,0,0,0.5) !important;
  padding: 0 20px !important;
  gap: 8px !important;
  z-index: 2001 !important;
  visibility: visible !important;
  opacity: 1 !important;
  overflow: visible !important;
  pointer-events: auto !important;
}

/* Smaller screens: allow narrower min-width and full-width layout */
@media (max-width: 900px) {
  body.scm-custom-layout .playControls.g-z-index-control-bar.m-visible,
  body.scm-custom-layout .playControls__inner {
    width: 95% !important;
    min-width: 0 !important;
    left: 50% !important;
    transform: translateX(-50%) !important;
  }
  body.scm-custom-layout .playControls__inner {
    padding: 0 12px !important;
  }
}

/* Ensure the central wrapper centers its controls so the scrubber and buttons stay centered */
body.scm-custom-layout .playControls__inner > .playControls__wrapper.l-container.l-fullwidth {
  display: flex !important;
  align-items: center !important;
  justify-content: center !important;
}

/* Fix: Ensure left/right action groups don't shrink and central wrapper grows */
body.scm-custom-layout .playControls__inner > .playControls__left,
body.scm-custom-layout .playControls__inner > .playControls__actions,
body.scm-custom-layout .playControls__inner > .playControls__controls,
body.scm-custom-layout .playControls__inner > .playControls__right {
  flex: 0 0 auto !important;
  min-width: 0 !important;
}

body.scm-custom-layout .playControls__inner > .playControls__wrapper.l-container.l-fullwidth {
  flex: 1 1 auto !important;
  min-width: 280px !important; /* allow timeline and central controls to grow */
}

/* 通常時もplayControls__innerを表示 */
.playControls__inner {
  visibility: visible !important;
  opacity: 1 !important;
  display: flex !important;
}

/* playControls__soundBadge sc-ml-3xを右端に配置 */
body.scm-custom-layout .playControls__inner {
  display: flex !important;
  flex-direction: row !important;
  align-items: center !important;
}

body.scm-custom-layout .playControls__soundBadge.sc-ml-3x {
  position: relative !important;
  z-index: 2002 !important;
  flex-shrink: 0 !important;
  visibility: visible !important;
  opacity: 1 !important;
  display: flex !important;
  align-items: center !important;
  margin-left: auto !important;
}

body.scm-custom-layout .playControls__wrapper.l-container.l-fullwidth {
  order: 0 !important;
  position: relative !important;
  z-index: 2001 !important;
  flex: 1 1 auto !important;
  min-width: 0 !important;
}

/* Allow the playback timeline to expand inside the central wrapper so it isn't cramped */
body.scm-custom-layout .playControls__wrapper.l-container.l-fullwidth .playbackTimeline.is-scrubbable.has-sound {
  flex: 1 1 60% !important; /* let timeline take up central space */
  min-width: 280px !important;
  margin: 0 10px !important;
}

/* Ensure the progress bar stretches to the available width */
body.scm-custom-layout .playControls__wrapper .playbackTimeline .playbackTimeline__progress,
body.scm-custom-layout .playControls__wrapper .playbackTimeline .playbackTimeline__progress .playbackTimeline__progressSpan {
  width: 100% !important;
}

/* Prevent left and right action groups from growing, so the timeline gets extra space */
body.scm-custom-layout .playControls__actions,
body.scm-custom-layout .playControls__left,
body.scm-custom-layout .playControls__controls,
body.scm-custom-layout .playControls__right {
  flex: 0 0 auto !important;
}

/* Immersionボタンも前面に表示 */
body.scm-custom-layout #scm-mode-toggle {
  order: 1000 !important;
  position: relative !important;
  z-index: 2002 !important;
}

/* IMMERSION ボタン（常に表示） */
#scm-mode-toggle {
  padding: 6px 12px !important;
  font-size: 11px !important;
  border-radius: 999px !important;
  background: rgba(255,255,255,0.16) !important;
  color: #fff !important;
  border: none !important;
  cursor: pointer !important;
  flex-shrink: 0 !important;
  font-weight: 700 !important;
  transition: 0.2s !important;
  margin-left: 6px !important;
  z-index: 2002 !important;
  position: relative !important;
  display: inline-block !important;
  visibility: visible !important;
  opacity: 1 !important;
  vertical-align: middle !important;
  line-height: 1 !important;
  white-space: nowrap !important;
}

#scm-mode-toggle:hover {
  background: rgba(255,255,255,0.25) !important;
}

#scm-mode-toggle.active {
  background: rgba(255,255,255,0.3) !important;
  box-shadow: 0 0 10px rgba(255,255,255,0.2) !important;
}

/* プレーヤーコントロール内のボタンのスタイル - すべての状況で表示 */
.playControls #scm-mode-toggle,
.playControls__inner #scm-mode-toggle,
.playControls__container #scm-mode-toggle,
.playControls__bar #scm-mode-toggle,
.playControls__actions #scm-mode-toggle,
.playControls__right #scm-mode-toggle,
.playControls__controls #scm-mode-toggle,
body #scm-mode-toggle {
  display: inline-block !important;
  visibility: visible !important;
  opacity: 1 !important;
  margin-left: 6px !important;
}

/* プレーヤーコントロールのスタイル調整 */
body.scm-custom-layout .playControls button,
body.scm-custom-layout .playControls .sc-button,
body.scm-custom-layout .playControls .sc-button-pause,
body.scm-custom-layout .playControls a,
body.scm-custom-layout .playControls input,
body.scm-custom-layout .playControls .sc-controls,
body.scm-custom-layout .playControls .sc-controls button,
body.scm-custom-layout .playControls .sc-button-small {
  color: #ffffff !important;
  fill: #ffffff !important;
  opacity: 1 !important;
  pointer-events: auto !important;
  cursor: pointer !important;
  background: transparent !important;
}

body.scm-custom-layout .playControls .sc-button-play {
  opacity: 1 !important;
  pointer-events: auto !important;
  cursor: pointer !important;
}

.playbackSoundBadge__showQueue.sc-button.sc-button-secondary.sc-button-small.sc-button-icon,
.playbackSoundBadge__showQueue.sc-button.sc-button-small.sc-button-icon {
  margin-right: 24px !important;
}

/* Make the play button white when the button has the `playing` class */
/* Also include the full specific class sequence (button element) to cover the exact DOM sample provided */
button.playControl.sc-ir.playControls__control.playControls__play.sc-button-play.sc-button-large.sc-mr-2x.playing,
button.playControl.sc-ir.playControls__control.playControls__play.sc-button-play.sc-button-large.sc-mr-2x.playing svg,
.playControls .sc-button-play.playing.sc-button,
body.scm-custom-layout .playControls .sc-button-play.playing.sc-button,
.playControls__play.sc-button.playing,
body.scm-custom-layout .playControls__play.sc-button.playing {
  background: #fff !important;
  color: #111 !important; /* ensure text/icon color is visible */
  border: none !important;
  border-radius: 9999px !important;
  transition: background 0.16s ease, box-shadow 0.16s ease;
}

/* Ensure svg icons/symbols inside the white play button are dark for contrast */
.playControls .sc-button-play.playing.sc-button svg,
.playControls .sc-button-play.playing.sc-button svg path,
body.scm-custom-layout .playControls .sc-button-play.playing.sc-button svg,
body.scm-custom-layout .playControls .sc-button-play.playing.sc-button svg path,
.playControls__play.sc-button.playing svg,
.playControls__play.sc-button.playing svg path,
body.scm-custom-layout .playControls__play.sc-button.playing svg,
body.scm-custom-layout .playControls__play.sc-button.playing svg path {
  fill: #111 !important;
  color: #111 !important;
}

/* Slightly emphasize the white play button when playing */
.playControls .sc-button-play.playing.sc-button,
.playControls__play.sc-button.playing {
  box-shadow: 0 4px 14px rgba(0,0,0,0.12) !important;
}

/* 1) Volumeコントロールの高さを他の要素と揃える */
/* 対象: playControls__volume とその中の sc-button 要素 */
.playControls__volume,
.playControls__volume .sc-button,
.playControls__volume .sc-controls,
.playControls__volume .sc-controls button {
  display: flex !important;
  align-items: center !important;
  /* height: 48px may be too large on some screens; set a more conservative min-height */
  min-height: 36px !important;
  padding: 6px 10px !important;
  box-sizing: border-box !important;
}
/* Ensure inner buttons don't stretch vertically from min-height */
.playControls__volume .sc-button,
.playControls__volume .sc-controls button {
  height: auto !important;
  min-height: 28px !important;
}

/* 3) playbackSoundBadge を右端に寄せる（残された幅内の右端に配置） */
body.scm-custom-layout .playControls__inner .playbackSoundBadge,
body.scm-custom-layout .playControls .playbackSoundBadge {
  /* do not change order to prevent DOM reordering; just push to right via parent margin */
  margin-left: auto !important;
  display: inline-flex !important;
  align-items: center !important;
  flex-shrink: 0 !important;
  align-self: center !important;
}

/* 追加: 右側にある playControls__soundBadge も確実に右寄せにする */
body.scm-custom-layout .playControls__soundBadge.sc-ml-3x,
body.scm-custom-layout .playControls__soundBadge {
  /* keep right-side anchoring on Immersion mode */
  margin-left: auto !important;
  display: flex !important;
  align-items: center !important;
}

/* ensure badge is last child: place it after the Immersion toggle */
body.scm-custom-layout .playControls__soundBadge.sc-ml-3x {
  order: 1001 !important;
}

/* Ensure soundBadge inside wrapper also anchors to right */
body.scm-custom-layout .playControls__wrapper .playControls__soundBadge {
  margin-left: auto !important;
}

/* Badge内部の要素は左寄せのままにする（Immersion時のバッジの内部が右に寄りすぎないように） */
body.scm-custom-layout .playControls__soundBadge .playbackSoundBadge__titleContainer,
body.scm-custom-layout .playControls__soundBadge .playbackSoundBadge__titleContextContainer,
body.scm-custom-layout .playControls__soundBadge .playbackSoundBadge__avatar {
  justify-content: flex-start !important;
}

body.scm-custom-layout .playControls .sc-slider,
body.scm-custom-layout .playControls .sc-range__wrapper,
body.scm-custom-layout .playControls input[type="range"] {
  color: #ffffff !important;
  pointer-events: auto !important;
  cursor: pointer !important;
}

/* レスポンシブ対応 */
@media (max-width: 1200px) {
  #scm-custom-wrapper {
    gap: 4vw;
    padding: 40px 3vw 120px 3vw;
  }

  #scm-custom-left-col {
    width: 350px;
  }

  #scm-spectrum-container {
    width: 500px;
  }
}

@media (max-width: 768px) {
  #scm-custom-wrapper {
    flex-direction: column;
    gap: 30px;
    padding: 80px 20px 120px 20px;
  }

  #scm-custom-left-col {
    width: 100%;
    max-width: 400px;
  }

  #scm-spectrum-container {
    width: 100%;
    max-width: 500px;
    height: 50vh;
  }
}
